---
- hosts: localhost
  vars:
    create_swarm: true
    vagrant: true
    aws: false
  roles:
    - role: infra-init

- hosts: shelleg-swarm-instances
  vars:
  become: yes
  become_user: root
  pre_tasks:
    - debug: msg="Install stuff on all swarm instances"
  roles:
    - role: shelleg-common
    - role: apt-cacher-ng
    - role: docker-host
    - role: docker-dnsmasq

- hosts: shelleg-manager1
  become: yes
  become_user: root
  pre_tasks:
    - debug: msg="initailaize Swarm manager"
  roles:
    - role: docker-swarm-manager

- hosts: shelleg-swarm-instances-workers
  become: yes
  become_user: root
  pre_tasks:
    - debug: msg="Join workers"
  roles:
    - role: docker-swarm-worker
  vars:
    - swarmToken: "{{ hostvars['shelleg-manager1']['swarmToken'] }}"
